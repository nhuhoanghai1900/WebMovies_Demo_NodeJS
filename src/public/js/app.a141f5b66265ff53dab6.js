document.addEventListener("DOMContentLoaded",(()=>{const e=document.querySelector(".scroll-container");let t,n,o=!1,s=!1;e&&(e.addEventListener("mousedown",(d=>{o=!0,s=!1,t=d.pageX-e.offsetLeft,n=e.scrollLeft,e.classList.add("dragging")})),e.addEventListener("mouseleave",(()=>{o=!1,e.classList.remove("dragging")})),e.addEventListener("mouseup",(()=>{o=!1,e.classList.remove("dragging")})),e.addEventListener("mousemove",(d=>{o&&(s=!0,d.preventDefault(),e.scrollLeft=n-(d.pageX-e.offsetLeft-t))})),e.querySelectorAll("a").forEach((e=>e.addEventListener("click",(e=>{s&&e.preventDefault()})))))})),document.addEventListener("DOMContentLoaded",(()=>{var e,t=document.forms["delete-soft-movies-form"];const n=document.getElementById("delete-movies-modal-01"),o=document.getElementById("btn__delete-movies-modal");n&&n.addEventListener("show.bs.modal",(n=>{const s=n.relatedTarget;e=s.getAttribute("data-id"),o.onclick=function(){t.action="/movies/"+e+"?_method=DELETE",t.submit()}}));const s=document.querySelector("#checkBox-all"),d=document.querySelectorAll('input[name="Ids[]"]'),r=(document.querySelector('input[name="Ids[]"]'),document.querySelector("#btn-disabled")),a=document.forms["container-form"];function c(){const e=document.querySelectorAll('input[name="Ids[]"]:checked').length;r.disabled=!(e>0)}s&&s.addEventListener("change",(()=>{const e=s.checked;d.forEach((t=>{t.checked=e})),c()})),d.forEach((e=>{e.addEventListener("change",(()=>{const e=Array.from(d).every((e=>e.checked));s.checked=e,c()}))})),r&&r.addEventListener("click",(e=>{const t=document.getElementById("floatingSelect");""===t.value?(e.preventDefault(),t.reportValidity()):a.submit()}))})),document.addEventListener("DOMContentLoaded",(()=>{var e,t=document.forms["delete-movies-form"],n=document.forms["restore-movies-form"];const o=document.getElementById("delete-movies-modal"),s=document.getElementById("btn__delete-movies-modal");o&&o.addEventListener("show.bs.modal",(n=>{const o=n.relatedTarget;e=o.getAttribute("data-id"),s.onclick=function(){t.action="/movies/"+e+"/force?_method=DELETE",t.submit()}})),document.querySelectorAll(".btn-restore").forEach((t=>t.addEventListener("click",(t=>{t.preventDefault(),e=t.currentTarget.getAttribute("data-id"),n.action="/movies/"+e+"/restore?_method=PATCH",n.submit()}))))}));const e=location.pathname.split("/"),t=e[e.length-1];document.querySelectorAll(".btn-movie-episodeId").forEach((e=>{e.dataset.episodeId==t&&e.classList.add("active")})),document.addEventListener("DOMContentLoaded",(()=>{const e=document.getElementById("delete-episode-modal"),t=document.getElementById("btn_delete-episode-modal"),n=document.forms["delete-episode-form"];var o;e&&e.addEventListener("show.bs.modal",(e=>{const s=e.relatedTarget;o=s.getAttribute("data-id"),t.onclick=function(){console.log("yes"),n.action="/movies/{{movies._id}}/episodes/"+o+"?_method=DELETE",n.submit()}}))}));const n=e=>{Toastify({text:e,duration:1500,gravity:"top",position:"right",style:{background:"#55a14e",color:"#fff",borderRadius:"8px",padding:"12px 16px"},close:!1}).showToast()},o=e=>{Toastify({text:e,duration:1500,gravity:"top",position:"right",style:{background:"#ff8a66",color:"#fff",borderRadius:"8px",padding:"12px 16px"},close:!1}).showToast()};document.querySelectorAll(".checkTokenMovies").forEach((e=>e.addEventListener("click",(async t=>{t.preventDefault();const n=e.getAttribute("href");try{const e=await fetch(n),t=await e.json();e.ok||o(t.message)}catch(e){window.location.href=n}})))),document.addEventListener("DOMContentLoaded",(()=>{const e=document.getElementById("logout");e&&e.addEventListener("click",(async e=>{e.preventDefault();try{if(!(await fetch("/users/logout",{method:"POST"})).ok)throw new Error("Logout thất bại");n("Bạn đang đăng xuất!"),setTimeout((()=>{window.location.reload()}),1500)}catch(e){o("Đăng xuất thất bại, thử lại sau")}})),FilePond.registerPlugin(FilePondPluginImagePreview),FilePond.create(document.getElementById("imageInput"),{labelIdle:'Đưa ảnh vào đây <span class="filepond--label-action">Chọn ảnh</span>',imagePreviewHeight:100,imageResizeTargetWidth:100,imageResizeTargetHeight:100,stylePanelLayout:"compact circle",styleButtonRemoveItemPosition:"center bottom"}),document.getElementById("uploadImage").addEventListener("click",(async e=>{e.preventDefault();const t=function(){const e=FilePond.find(document.querySelector(".filepond")).getFiles(),t=e[0]?.file;if(t){const e=new FormData;return e.append("img",t),e}return console.log("Chưa chọn ảnh!"),null}();if(t)try{const e=await fetch("/users/upload-avatar",{method:"POST",body:t}),s=await e.json();e.ok?(n("Cập nhật ảnh thành công!"),setTimeout((()=>{window.location.reload()}),1500)):o(s.message)}catch(e){console.error("Lỗi khi upload:",e.message)}}))})),document.addEventListener("DOMContentLoaded",(()=>{const e=document.getElementById("searchInput"),t=document.getElementById("suggestionBox");e&&e.addEventListener("input",(async()=>{const o=e.value.trim().toLowerCase();if(o)try{const e=await fetch(`/search/searchMovies?q=${encodeURIComponent(o)}`);!function(e){n=-1,t.textContent="";const o=document.getElementById("suggestion-template");e.forEach((e=>{const n=o.content.cloneNode(!0),s=n.querySelector(".suggestion-img"),d=n.querySelector(".suggestion-name"),r=n.querySelector(".suggestion-schedule");s.src=e.img,d.textContent=e.name+" - "+e.status,r.textContent=e.schedule,n.querySelector(".suggestion-item").addEventListener("click",(()=>{window.location.href=`/movies/${e.slug}/details`})),t.appendChild(n)})),t.style.display="block"}(await e.json())}catch(e){console.error("Lỗi khi seach",e)}else t.textContent=""}));let n=-1;function o(e){e.forEach(((e,t)=>{e.classList.toggle("active",t===n)}));const t=e[n];t&&t.scrollIntoView({behavior:"smooth",block:"nearest"})}document.addEventListener("keydown",(e=>{const t=document.querySelectorAll(".suggestion-item");t.length&&("ArrowDown"===e.key&&(e.preventDefault(),n=(n+1)%t.length,o(t)),"ArrowUp"===e.key&&(e.preventDefault(),n=(n-1+t.length)%t.length,o(t)),"Enter"===e.key&&(e.preventDefault(),n>=0&&t[n]&&t[n].click()))}))})),document.addEventListener("DOMContentLoaded",(()=>{const e=document.getElementById("login-form");e&&e.addEventListener("submit",(async e=>{e.preventDefault(),document.getElementById("email-error").textContent="",document.getElementById("password-error").textContent="",document.getElementById("check-error").textContent="";const t={email:document.getElementById("email").value,password:document.getElementById("password").value},o=await fetch("/users/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),s=await o.json();o.ok?(n("Đăng nhập thành công!"),setTimeout((()=>{window.location.href="/"}),2e3)):s.errors?Object.keys(s.errors).forEach((e=>{const t=document.getElementById(`${e}-error`);t&&(t.textContent=s.errors[e])})):document.getElementById("check-error").textContent=s.message}))})),document.addEventListener("DOMContentLoaded",(()=>{const e=document.getElementById("register-form");e&&e.addEventListener("submit",(async e=>{e.preventDefault(),document.getElementById("email-error").textContent="",document.getElementById("password-error").textContent="",document.getElementById("password-error-confirm").textContent="";const t={fullName:document.getElementById("fullName").value,email:document.getElementById("email").value,password:document.getElementById("password").value,confirmPassword:document.getElementById("confirmPassword").value},o=await fetch("/users/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),s=await o.json();o.ok?(n("Đăng ký thành công!"),setTimeout((()=>{window.location.href="/users/login"}),1500)):s.errors&&Object.keys(s.errors).forEach((e=>{const t=document.getElementById(`${e}-error`);t?t.textContent=s.errors[e]:document.getElementById("password-error-confirm").textContent=s.errors[e]}))}))})),document.addEventListener("DOMContentLoaded",(()=>{const e=document.getElementById("password");e&&e.addEventListener("input",(()=>{const t=document.getElementById("password-error"),n=[];t.classList.replace("text-success","text-danger"),(e.value.length<6||e.value.length>12)&&n.push("- Mật khẩu phải từ 6 đến 12 ký tự!"),/[A-Z]/.test(e.value)||n.push("- Mật khẩu có ít nhất 1 chữ in Hoa!"),/[a-z]/.test(e.value)||n.push(" - Mật khẩu có ít nhất 1 chữ thường!"),/\d/.test(e.value)||n.push("- Mật khẩu có ít nhất 1 số!"),n.length>0?t.innerHTML=n.join("<br>"):(t.innerHTML="MẬT KHẨU ĐƯỢC CHẤP NHẬN",t.classList.replace("text-danger","text-success"))}));const t=document.getElementById("togglePassword");t&&t.addEventListener("click",(()=>{const t="password"===e.type,n=document.getElementById("toggleIcon");t?(e.type="text",n.classList.replace("bi-eye","bi-eye-slash")):(e.type="password",n.classList.replace("bi-eye-slash","bi-eye"))}));const n=document.getElementById("confirmPassword");n&&n.addEventListener("input",(()=>{const t=document.getElementById("password-error-confirm");n.value!==e.value?t.innerHTML="- Mật khẩu xác nhận không chính xác":t.innerHTML=""}));const o=document.getElementById("togglePasswordConfirm");o&&o.addEventListener("click",(()=>{const e="password"===n.type,t=document.getElementById("toggleIconConfirm");e?(n.type="text",t.classList.replace("bi-eye","bi-eye-slash")):(n.type="password",t.classList.replace("bi-eye-slash","bi-eye"))}))}));